<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Post test</title>
</head>
<body>
<form id="myForm">
	<input type='text' id='username' name='username'>
	<input type="password" id='password' name="password">
	<input type="file" id='myfile' name="myfile">
	<input type="button" onclick="sendJSON()" value="sendJSON">
	<input type="button" onclick="sendFORM()" value="sendFORM">
</form>
<div id="result"></div>
<script>
async function postJSON(url = '', data = {}){
	// 注释中带*为缺省值
	let res = await fetch(url, {
        method: 'POST', //访问方法：*GET, POST, PUT, DELETE, etc.
        mode: 'cors', //跨域访问:no-cors, *cors, same-origin
		cache:'no-cache', //缓存方法：*default, no-cache, reload, force-cache, only-if-cached
        headers: new Headers({   //提交数据类型
            'Content-Type': 'application/json;charset=utf-8'
        }),
		body: JSON.stringify(data) //body的数据类型要和"Content-Type"一致
        });
	//console.log(res);
	return res.json(); // 将JSON转成Javascript对象
}

async function postFORM(url = '', data = new FormData()){
	// 注释中带*为缺省值
	let res = await fetch(url, {
        method: 'POST', //访问方法：*GET, POST, PUT, DELETE, etc.
        mode: 'cors', //跨域访问:no-cors, *cors, same-origin
		cache:'no-cache', //缓存方法：*default, no-cache, reload, force-cache, only-if-cached
        headers: new Headers({   //提交数据类型
            //'Content-Type': 'multipart/form-data'
        }),
		body: data //body的数据类型要和"Content-Type"一致
        });
	//console.log(res);
	return res.formData(); // 将FormData转成Javascript对象
}


async function sendJSON() {
	let username = document.querySelector('#username');
	let password = document.querySelector('#password');
	//待提交的数据
	let user = {username:username.value, password:password.value};
	console.log(user);

	//向/test提交数据
	/*
	postJSON('http://localhost:5000/test', user).then(data => {
		let ret = document.getElementById('result');
		//服务器返回的数据
		ret.innerHTML = JSON.stringify(data);
	});
	*/

	let res = await postJSON('http://localhost:5000/test1', user);
	let ret = document.getElementById('result');
	//服务器返回的数据
	ret.innerHTML = JSON.stringify(res); 
}

async function sendFORM(){

	let form = document.querySelector("#myForm");
    //将获得的表单元素作为参数，对formData进行初始化
    let formdata = new FormData(form);
	console.log(formdata);

	let res = await postFORM('http://localhost:5000/test2', formdata);
	let ret = document.getElementById('result');
	//服务器返回的数据
	ret.innerHTML = res.get('username') + "|" + res.get('password' ) + "|" + `<img src="${URL.createObjectURL(res.get('myfile'))}">`; 
}
</script>
</body>
</html>